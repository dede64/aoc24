import Foundation

class Day6Easy {
    struct Coord: Hashable {
        let x: Int
        let y: Int
    }
    
    enum Direction {
        case up
        case right
        case down
        case left
        
        var rotate: Direction {
            switch self {
            case .up: return .right
            case .right: return .down
            case .down: return .left
            case .left: return .up
            }
        }
    }
    
    enum ValidationResult {
        case valid
        case obstacle
        case outside
    }
    
    func solve() {
        var obstacleMap: Set<Coord> = .init()
        var guardCoord: Coord = .init(x: 0, y: 0)
        var guardDirection: Direction = .up
        var visitedCoords: Set<Coord> = .init()
        var areaWidth: Int = 0
        var areaHeight: Int = 0
        
        
        let text = input
        let lines = text.split(separator: "\n")
        
        areaWidth = lines[0].count
        areaHeight = lines.count
        
        for i in lines.indices {
            let line = lines[i].split(separator: "")
            
            for j in line.indices {
                let char = line[j]
                
                if char == "#" {
                    obstacleMap.insert(Coord(x: j, y: i))
                } else if char == "^" {
                    guardCoord = Coord(x: j, y: i)
                    guardDirection = .up
                } else if char == ">" {
                    guardCoord = Coord(x: j, y: i)
                    guardDirection = .right
                } else if char == "v" {
                    guardCoord = Coord(x: j, y: i)
                    guardDirection = .down
                } else if char == "<" {
                    guardCoord = Coord(x: j, y: i)
                    guardDirection = .left
                }
            }
        }
        
        visitedCoords.insert(guardCoord)
        
        var isOk: Bool = true
        while isOk {
            let newCoord: Coord
            
            switch guardDirection {
            case .up:
                newCoord = .init(x: guardCoord.x, y: guardCoord.y - 1)
            case .right:
                newCoord = .init(x: guardCoord.x + 1, y: guardCoord.y)
            case .down:
                newCoord = .init(x: guardCoord.x, y: guardCoord.y + 1)
            case .left:
                newCoord = .init(x: guardCoord.x - 1, y: guardCoord.y)
            }
            
            let validationResult = validateCoord(newCoord, width: areaWidth, height: areaHeight, obstacles: obstacleMap)
            
            switch validationResult {
            case .valid:
                visitedCoords.insert(newCoord)
                guardCoord = newCoord
            case .obstacle:
                guardDirection = guardDirection.rotate
            case .outside:
                isOk = false
            }
        }
        
        print(visitedCoords.count)
    }
    
    func validateCoord(_ coord: Coord, width: Int, height: Int, obstacles: Set<Coord>) -> ValidationResult {
        if coord.x < 0 || coord.x >= width || coord.y < 0 || coord.y >= height {
            return .outside
        }
        
        if obstacles.contains(coord) {
            return .obstacle
        }
        
        return .valid
    }
    
    let easyInput: String = """
    ....#.....
    .........#
    ..........
    ..#.......
    .......#..
    ..........
    .#..^.....
    ........#.
    #.........
    ......#...
    """
    
    let input: String = """
    ............#...........................................#.......#.............#...........#.......................................
    ..........#....................#.........................................#............#............#.....##...................#...
    .#.........#..........#.....#......##...............................................................#..................#..........
    ...........#.#...................#..................#.......................#........#............#...............................
    ...#..........................#............................#..................#..................#..........##..................#.
    ..............................................................................#...................................#..........#.#..
    .#......##........#.........#...........#...............................#...................#........#..#............#.........##.
    .....................................#...................................................................#........................
    ......................#......................#.............................................#......................................
    ....................................................#...........#........................#...................#......#.#.........##
    ..................#..#..........#...........................#.#..........#.......##....................#.#....#..#................
    ............#...#..........................#.............................................................................#........
    ...............................#.............#.........#..........................................................................
    .....#......#........#.#...............#.........................#.......#.......#.........................#......................
    ...#....#........................##.................#..#...............................#..........#...............................
    ..........#......#..............................................................#...................#..........#.........#.#......
    #.............#.........#.................................#....................#....................#......................#......
    ....#.............................................#..................#.........#...#................#........#....#..........#....
    .......#......................................#.......#..........................................................#................
    ...#..#..............#.........#......#...........................................#..............................###.....#........
    ......................................................#........#..............................#..................#................
    .......................................#.....#.........................................................................#..........
    ...........................#...........#....................................#.........#...........................................
    ....#........#...................................................................#...................................#............
    ....#..#.................................................#........................#...............................................
    ............................................................##..#......................#.......#...........#..#........#..........
    ........#.........................................................................................................................
    ............#......#.........#...............##...............................#......#......................#......#..............
    .#......#...............................................#.#........................#....#.....#..#................##..............
    .........#.....#.............#.........#.............................#.................#.........##.......#.......................
    ...#..............................................................................#....................#..........................
    .#...#.....#..............#.................................................#..............................................#......
    ....................................................#...#..................................................................#......
    ..............#................#.......................................................................#.........#................
    ...........#..............................#.....#.........#..#............................#.......................................
    .........................#............#..................................#...#.....#......#.......................................
    ..........#......................#...#....#......#.....................#..................................#.....#........#........
    .............#...#........#.........................................#..#........................................................#.
    .....#...............#......#.........##.....#.......................#..............#....................................#...#....
    .....................#..........................................................................................#.............#...
    .................#.............#..............##...................................................#..............................
    ..................................#.......#.......................................#...........#...................................
    ...#..............#............................#.#................................................................................
    ..........#.......#...........................#...........................#..............................#....................#...
    .....#...#...#.................#..........................................................#............#.....................#.#..
    ...#...#......#.............#...............................................................................#...##................
    ..........#.....#.......#............#........................#..........................................#.............#..........
    ..................................................#.................#.........................#.#.......#.........................
    .............................#...............................#.#............#................#...................#...............#
    ..#...........#........................#............................................#...........#............#....................
    .......................#...#...........................#............#..#..#............#..#..............................#........
    .......#...........#...............#.............................................................................#................
    ...........................#................................#....#....#...#..................#...................#.#..........##..
    ...#.#.......................................................................................#.....#..........#..........#........
    ....#......#.......................................................#.......#.#............................#.......................
    .#.................#...#........#...#...........................#...#.................^......#............#.......................
    ...........#................##..........................................................................#.........................
    ...........................................................#....#............................#........#...........................
    .#......#....#..#.......#....................#...............................................#........#...........................
    ......................##..............##.......................#...#...............#........................#................#....
    #..................................................................................................#..........#...................
    .....................#...................................................................................#............#.....#.....
    ..........................##.#............................................#........#.#.......#.#....#...#.........................
    ....#...............#.................................................................................#..#...........##...........
    .................................................................#.#.....#.........#...............#..............................
    .......................................................#.......#.........#............#....#..........#.....................#.....
    #..............................................#..#..................#....................#.......................#....#....#.....
    ................#...............#..............................................................#....#...........................#.
    .#...............#..#....................#...........................................#............................................
    ................................#...........................................#.........................#..#........................
    .......#......#........................................#....................................................#.....................
    .#......................#........................#...............#......................#...........#.............................
    ........#.......#..................#.......................#.........#.....................................................#.....#
    ..................#.....................#...#..........................................................#.............#............
    ....#........................#......#...#.....................#....##.........#...................................................
    ......................#....................#....................................................#..........#..................#...
    .......#..........#.....................#.................................................#.......................................
    ....................#.......................................................#....##...................................#...........
    ................................#.............................................#.....#..............#..............................
    ..#.....#.......#..................................#........................#.....................................................
    ...##........#.#........#.........................................#..............#......................................#.........
    ........................................................................................#.........................................
    .......................#......#...........................................................................#.......................
    .........#...................#.............................................................#.........#............................
    ..........................#.................................................#................#...................................#
    ...............................#......................................#.........................#....#......#................#....
    ..........#.......................................................................................................................
    ....#......#.#.................#.#.......#.........#...#................#...............#..............#.....................#....
    ....#.........#....#................#..........#........#...................#.............#...............#..........#...#........
    ................#...............#.....#.....#...........#....#....................#.....#...................#.....................
    .......................#.......................#...........................................................#.....................#
    #.................................................................................................#...............................
    .........................................##..#........#............................#............#........................#........
    ....................#...............#............#................................................................................
    ...#................#............#..............................................................#.#.................###...........
    ......#...........................#.......#....#...............#....................................................#.....#.......
    ..#.......##.....................#................#.....................................................#.#......................#
    .................................................................#.................................##.............................
    ....#..............................................#................................................................#....#........
    ................#................................................#..............................................#...#...........#.
    ...................................##...............................................................................#.............
    ............#.................#..#.........................#..........................#.......#...................................
    .......##........#.#...#......................................#..............#...............................#.............#......
    ............#.............................................##..............................#............................#..........
    .................................................#..........................#.........#...#...............................#.......
    ..#............#......................#.....................................#.....##.........................#....................
    ...........#......#............#...................#.......................#..##........................................#.........
    .................................##......#.........#.......#..................##...............#..................................
    ........#.........#...##.........#.#......#.........#.......#.....#.......................#.......................................
    ..................................#..............#................#.....#..............##...............#.........................
    ................#..........................................#..#.......#....................................#......................
    ..................................................#...........#..........................#.................#......................
    .........#....................................................#..........#........................................#...............
    ..........................#..............................................#.................................................#......
    ...#....................................#.......................#.#.......#............##........#........................#.......
    ...#..................................#.....#...........................................................#...#........#............
    ................#...........#.........................................................#...............#....................#....#.
    .................#...........#..............................#..........#........#............................#..........#.........
    .........#.............................................#..........#....#.................#...................#...#................
    ......#....................#.................#.......#..............#............................#..#.......................#...#.
    #.....#..........................#.....#...................................#...##.....#.....#...........#................#......#.
    .##................#.........#.........#...#.#....................................................................................
    .............................................................#..#...............#..#...............#.....#....#.............#..#..
    .............#.........#.......#....#.........#...#......#........#.............................#.................................
    #.....................................#.......#..................#..................#............#...#......#.........#...........
    .......##............#.............#..............#.....#........#.................#..#..........#......................#..#......
    ......#......#.............#....#...............#.......#....................##.................................................##
    ...............#........#........#........................#.#........#.............#...................................#...##.....
    ................#........................#.......#......#..........................#................#............#...#....#.......
    #.................#.....................#..........#.....................#...................##..........................#........
    """
}
